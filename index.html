<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è‡ªå‹•é‹è»¢ãƒ»ãƒ­ãƒœã‚¿ã‚¯ã‚·ãƒ¼ ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒãƒ–</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #f1f5f9;
      min-height: 100vh;
      line-height: 1.6;
    }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(15, 23, 42, 0.5); }
    ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }

    .container { max-width: 1400px; margin: 0 auto; padding: 0 24px; }

    /* Header */
    header {
      background: rgba(15, 23, 42, 0.95);
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
      padding: 16px 24px;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(12px);
    }
    .header-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .logo-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    .logo h1 { font-size: 20px; font-weight: 700; }
    .logo p { font-size: 12px; color: #94a3b8; }
    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .last-updated {
      display: flex;
      align-items: center;
      gap: 6px;
      color: #94a3b8;
      font-size: 13px;
    }
    .btn-refresh {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
    }
    .btn-refresh:hover { opacity: 0.9; }

    /* Main */
    main { padding: 24px 0; }

    /* Section Title */
    .section-title {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
      font-size: 18px;
      font-weight: 600;
    }

    /* Top News */
    .top-news-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }
    .top-news-card {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 12px;
      padding: 20px;
      position: relative;
    }
    .rank-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      color: #0f172a;
    }
    .rank-1 { background: #fbbf24; }
    .rank-2 { background: #94a3b8; }
    .rank-3 { background: #cd7f32; }

    /* Tags */
    .tags {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .tag {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
    }
    .tag-source {
      background: rgba(148, 163, 184, 0.2);
      font-weight: 400;
    }

    /* Cards */
    .card-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 8px;
      line-height: 1.5;
    }
    .card-summary {
      font-size: 13px;
      color: #94a3b8;
      line-height: 1.6;
    }
    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
    }
    .score-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 700;
      color: #0f172a;
    }
    .time-ago {
      font-size: 12px;
      color: #64748b;
    }

    /* Filters Section */
    .filters-section {
      background: rgba(30, 41, 59, 0.5);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
      border: 1px solid rgba(148, 163, 184, 0.1);
    }
    .filters-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
    }
    .search-box {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(15, 23, 42, 0.8);
      border-radius: 8px;
      padding: 10px 14px;
      flex: 1;
      max-width: 400px;
      min-width: 200px;
    }
    .search-box input {
      background: none;
      border: none;
      color: #f1f5f9;
      font-size: 14px;
      width: 100%;
      outline: none;
    }
    .search-box input::placeholder { color: #64748b; }

    .btn-filter {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 10px 14px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid transparent;
      border-radius: 8px;
      color: #f1f5f9;
      cursor: pointer;
      font-size: 14px;
    }
    .btn-filter.active {
      background: rgba(59, 130, 246, 0.2);
      border-color: #3b82f6;
    }

    .sort-select {
      padding: 8px 12px;
      background: rgba(15, 23, 42, 0.8);
      border: none;
      border-radius: 6px;
      color: #f1f5f9;
      font-size: 13px;
      cursor: pointer;
    }

    .filter-panel {
      display: none;
      border-top: 1px solid rgba(148, 163, 184, 0.1);
      padding-top: 16px;
      margin-top: 16px;
    }
    .filter-panel.show { display: block; }

    .filter-group {
      margin-bottom: 16px;
    }
    .filter-group:last-child { margin-bottom: 0; }
    .filter-label {
      font-size: 12px;
      color: #94a3b8;
      margin-bottom: 8px;
    }
    .filter-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .filter-btn {
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      background: rgba(15, 23, 42, 0.8);
      color: #f1f5f9;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }
    .filter-btn:hover { background: rgba(59, 130, 246, 0.3); }
    .filter-btn.active { background: #3b82f6; }

    .company-btn {
      padding: 4px 10px;
      border-radius: 4px;
      border: 2px solid transparent;
      background: rgba(15, 23, 42, 0.8);
      color: #f1f5f9;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }

    /* News List */
    .news-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .news-item {
      background: rgba(30, 41, 59, 0.5);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(148, 163, 184, 0.1);
      display: flex;
      gap: 16px;
    }
    .priority-bar {
      width: 4px;
      border-radius: 2px;
      flex-shrink: 0;
    }
    .news-content { flex: 1; min-width: 0; }

    .news-meta {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
      flex-wrap: wrap;
      align-items: center;
    }
    .meta-tag {
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 11px;
    }
    .importance-badge {
      font-weight: 600;
    }
    .news-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
      line-height: 1.5;
    }
    .news-summary {
      font-size: 14px;
      color: #94a3b8;
      margin-bottom: 12px;
      line-height: 1.7;
    }
    .hash-tags {
      display: flex;
      gap: 6px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .hash-tag {
      padding: 2px 8px;
      border-radius: 4px;
      background: rgba(59, 130, 246, 0.15);
      color: #60a5fa;
      font-size: 11px;
    }
    .news-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
    }
    .engagement {
      display: flex;
      gap: 16px;
      color: #64748b;
      font-size: 13px;
    }
    .engagement span {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .news-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .priority-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
    }
    .btn-read {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 6px 12px;
      border-radius: 6px;
      background: rgba(59, 130, 246, 0.2);
      color: #60a5fa;
      text-decoration: none;
      font-size: 13px;
    }
    .btn-read:hover { background: rgba(59, 130, 246, 0.3); }

    /* Info Sections */
    .info-section {
      margin-top: 32px;
      background: rgba(30, 41, 59, 0.3);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(148, 163, 184, 0.1);
    }
    .info-section h3 {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
    }
    .info-section p {
      font-size: 13px;
      color: #94a3b8;
      line-height: 1.7;
    }
    .info-section strong { color: #f1f5f9; }

    .api-section {
      background: rgba(139, 92, 246, 0.1);
      border-color: rgba(139, 92, 246, 0.3);
    }
    .api-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin: 16px 0;
    }
    .api-card {
      background: rgba(15, 23, 42, 0.5);
      padding: 12px;
      border-radius: 8px;
    }

    /* Footer */
    footer {
      margin-top: 48px;
      padding: 24px;
      border-top: 1px solid rgba(148, 163, 184, 0.1);
      text-align: center;
      color: #64748b;
      font-size: 13px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header-inner { flex-direction: column; text-align: center; }
      .top-news-grid { grid-template-columns: 1fr; }
      .news-item { flex-direction: column; }
      .priority-bar { width: 100%; height: 4px; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="header-inner">
      <div class="logo">
        <div class="logo-icon">ğŸš—</div>
        <div>
          <h1>è‡ªå‹•é‹è»¢ãƒ»ãƒ­ãƒœã‚¿ã‚¯ã‚·ãƒ¼ ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒãƒ–</h1>
          <p>Autonomous Driving & Robotaxi News Hub</p>
        </div>
      </div>
      <div class="header-right">
        <div class="last-updated">
          <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          <span id="lastUpdated"></span>
        </div>
        <button class="btn-refresh" onclick="location.reload()">
          <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
          æ›´æ–°
        </button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Top News Section -->
    <section>
      <h2 class="section-title">
        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
        æœ¬æ—¥ã®ãƒˆãƒƒãƒ—ãƒ‹ãƒ¥ãƒ¼ã‚¹
      </h2>
      <div class="top-news-grid" id="topNews"></div>
    </section>

    <!-- Filters Section -->
    <section class="filters-section">
      <div class="filters-row">
        <div style="display: flex; align-items: center; gap: 12px; flex: 1; min-width: 280px;">
          <div class="search-box">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
            <input type="text" id="searchInput" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢...">
          </div>
          <button class="btn-filter" id="filterToggle" onclick="toggleFilters()">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z"/></svg>
            ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
          </button>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span style="font-size: 13px; color: #94a3b8;">ä¸¦ã³é †:</span>
          <select class="sort-select" id="sortSelect">
            <option value="priority">å„ªå…ˆåº¦ã‚¹ã‚³ã‚¢</option>
            <option value="time">æ–°ç€é †</option>
            <option value="engagement">ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ</option>
          </select>
        </div>
      </div>

      <div class="filter-panel" id="filterPanel">
        <div class="filter-group">
          <p class="filter-label">åœ°åŸŸ</p>
          <div class="filter-buttons" id="countryFilters"></div>
        </div>
        <div class="filter-group">
          <p class="filter-label">æƒ…å ±ã‚½ãƒ¼ã‚¹</p>
          <div class="filter-buttons" id="sourceFilters"></div>
        </div>
        <div class="filter-group">
          <p class="filter-label">ä¼æ¥­</p>
          <div class="filter-buttons" id="companyFilters"></div>
        </div>
      </div>
    </section>

    <!-- News List -->
    <section>
      <h2 class="section-title">ãƒ‹ãƒ¥ãƒ¼ã‚¹ä¸€è¦§ <span id="newsCount" style="font-size: 14px; color: #64748b; font-weight: 400; margin-left: 8px;"></span></h2>
      <div class="news-list" id="newsList"></div>
    </section>

    <!-- Score Info -->
    <section class="info-section">
      <h3>ğŸ“Š å„ªå…ˆåº¦ã‚¹ã‚³ã‚¢ã«ã¤ã„ã¦</h3>
      <p>
        å„ªå…ˆåº¦ã‚¹ã‚³ã‚¢ã¯ä»¥ä¸‹ã®è¦ç´ ã‚’çµ„ã¿åˆã‚ã›ã¦ç®—å‡ºã•ã‚Œã¦ã„ã¾ã™ï¼š<br>
        <strong>æ™‚é–“æ¸›è¡° (30%)</strong> - æ–°ã—ã„ãƒ‹ãƒ¥ãƒ¼ã‚¹ã»ã©é«˜ã‚¹ã‚³ã‚¢ï¼ˆ24æ™‚é–“ã§åŠæ¸›ï¼‰<br>
        <strong>ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ (35%)</strong> - ã„ã„ã­ã€ã‚³ãƒ¡ãƒ³ãƒˆã€ã‚·ã‚§ã‚¢æ•°ã‚’è€ƒæ…®<br>
        <strong>ã‚½ãƒ¼ã‚¹ä¿¡é ¼åº¦ (20%)</strong> - å…¬å¼ç™ºè¡¨ &gt; ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¡ãƒ‡ã‚£ã‚¢ &gt; SNS<br>
        <strong>é‡è¦åº¦ãƒœãƒ¼ãƒŠã‚¹ (15%)</strong> - æ¥­ç•Œã«å¤§ããªå½±éŸ¿ã‚’ä¸ãˆã‚‹ãƒ‹ãƒ¥ãƒ¼ã‚¹ã«åŠ ç‚¹
      </p>
    </section>

    <!-- API Guide -->
    <section class="info-section api-section">
      <h3>ğŸ”§ APIé€£æºã‚¬ã‚¤ãƒ‰ï¼ˆDailyæ›´æ–°ã®å®Ÿè£…ï¼‰</h3>
      <p>ã“ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¯ç¾åœ¨ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã§å‹•ä½œã—ã¦ã„ã¾ã™ã€‚Dailyæ›´æ–°ã‚’å®Ÿç¾ã™ã‚‹ã«ã¯ä»¥ä¸‹ã®APIã‚’æ´»ç”¨ï¼š</p>
      <div class="api-grid">
        <div class="api-card"><strong>ğŸ“° ãƒ‹ãƒ¥ãƒ¼ã‚¹API</strong><br>NewsAPI.org, GNews</div>
        <div class="api-card"><strong>ğ• X (Twitter) API</strong><br>Twitter API v2</div>
        <div class="api-card"><strong>ğŸ”´ Reddit API</strong><br>Reddit Data API</div>
      </div>
      <p style="color: #a5b4fc;">Cron/GitHub Actionsã§æ¯æ—¥å®šæ™‚ã«ãƒ‡ãƒ¼ã‚¿å–å¾— â†’ JSONãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–° â†’ Vercel/Netlifyã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤</p>
    </section>
  </main>

  <footer>
    <p>ğŸš— è‡ªå‹•é‹è»¢ãƒ»ãƒ­ãƒœã‚¿ã‚¯ã‚·ãƒ¼ ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒãƒ– | Dailyæ›´æ–° | å¯¾è±¡ä¼æ¥­: Tesla, Waymo, Uber, Lyft, Zoox, Lucid, DiDi, Pony.ai, WeRide, Baidu, Toyota, Honda, æ—¥ç”£ ä»–</p>
  </footer>

  <script>
    // ===== ãƒ‡ãƒ¼ã‚¿å®šç¾© =====
    const COMPANIES = [
      { id: 'tesla', name: 'Tesla', country: 'us', color: '#E31937' },
      { id: 'waymo', name: 'Waymo', country: 'us', color: '#4285F4' },
      { id: 'uber', name: 'Uber', country: 'us', color: '#000000' },
      { id: 'lyft', name: 'Lyft', country: 'us', color: '#FF00BF' },
      { id: 'zoox', name: 'Zoox', country: 'us', color: '#6B4EFF' },
      { id: 'lucid', name: 'Lucid', country: 'us', color: '#7C7C7C' },
      { id: 'cruise', name: 'Cruise', country: 'us', color: '#FF6B00' },
      { id: 'aurora', name: 'Aurora', country: 'us', color: '#00C7B7' },
      { id: 'didi', name: 'DiDi', country: 'cn', color: '#FF7A00' },
      { id: 'pony', name: 'Pony.ai', country: 'cn', color: '#00D4AA' },
      { id: 'weride', name: 'WeRide', country: 'cn', color: '#0066FF' },
      { id: 'baidu', name: 'Baidu Apollo', country: 'cn', color: '#2932E1' },
      { id: 'momenta', name: 'Momenta', country: 'cn', color: '#FF3366' },
      { id: 'toyota', name: 'Toyota', country: 'jp', color: '#EB0A1E' },
      { id: 'honda', name: 'Honda', country: 'jp', color: '#CC0000' },
      { id: 'sony', name: 'Sony (AFEELA)', country: 'jp', color: '#000000' },
      { id: 'nissan', name: 'æ—¥ç”£', country: 'jp', color: '#C3002F' },
      { id: 'tier4', name: 'Tier IV', country: 'jp', color: '#00A0E9' }
    ];

    const SOURCES = [
      { id: 'news', name: 'ãƒ‹ãƒ¥ãƒ¼ã‚¹', icon: 'ğŸ“°', weight: 1.0 },
      { id: 'x', name: 'X (Twitter)', icon: 'ğ•', weight: 0.8 },
      { id: 'reddit', name: 'Reddit', icon: 'ğŸ”´', weight: 0.7 },
      { id: 'official', name: 'å…¬å¼ç™ºè¡¨', icon: 'ğŸ¢', weight: 1.5 }
    ];

    const COUNTRIES = [
      { id: 'all', name: 'ã™ã¹ã¦', flag: 'ğŸŒ' },
      { id: 'us', name: 'ã‚¢ãƒ¡ãƒªã‚«', flag: 'ğŸ‡ºğŸ‡¸' },
      { id: 'cn', name: 'ä¸­å›½', flag: 'ğŸ‡¨ğŸ‡³' },
      { id: 'jp', name: 'æ—¥æœ¬', flag: 'ğŸ‡¯ğŸ‡µ' }
    ];

    // ===== ãƒ¢ãƒƒã‚¯ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ =====
    function generateMockNews() {
      const now = new Date();
      return [
        { id: 1, title: 'Waymoã€ãƒ­ã‚µãƒ³ã‚¼ãƒ«ã‚¹ã§ãƒ­ãƒœã‚¿ã‚¯ã‚·ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ­£å¼é–‹å§‹', summary: 'WaymoãŒãƒ­ã‚µãƒ³ã‚¼ãƒ«ã‚¹å¸‚å†…å…¨åŸŸã§ãƒ­ãƒœã‚¿ã‚¯ã‚·ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã€ŒWaymo Oneã€ã‚’ä¸€èˆ¬å‘ã‘ã«é–‹å§‹ã€‚24æ™‚é–“å¯¾å¿œã§æœˆé–“10ä¸‡å›ä»¥ä¸Šã®é…è»Šã‚’ç›®æŒ‡ã™ã€‚', source: 'news', sourceDetail: 'TechCrunch', company: 'waymo', url: '#', publishedAt: new Date(now - 2 * 60 * 60 * 1000).toISOString(), engagement: { likes: 2840, comments: 156, shares: 892 }, importance: 'high', tags: ['ã‚µãƒ¼ãƒ“ã‚¹é–‹å§‹', 'ãƒ­ã‚µãƒ³ã‚¼ãƒ«ã‚¹', 'å•†ç”¨åŒ–'] },
        { id: 2, title: 'Tesla FSD v13.2ã€æ—¥æœ¬ã§ã®èªè¨¼å–å¾—ã«å‘ã‘èª¿æ•´ä¸­', summary: 'ã‚¤ãƒ¼ãƒ­ãƒ³ãƒ»ãƒã‚¹ã‚¯æ°ãŒXã§ç™ºè¡¨ã€‚æ—¥æœ¬ã®é“è·¯äº¤é€šæ³•è¦åˆ¶ã«å¯¾å¿œã—ãŸFSDï¼ˆFull Self-Drivingï¼‰ã®ç‰¹åˆ¥ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é–‹ç™ºä¸­ã¨ã®ã“ã¨ã€‚', source: 'x', sourceDetail: '@elonmusk', company: 'tesla', url: '#', publishedAt: new Date(now - 5 * 60 * 60 * 1000).toISOString(), engagement: { likes: 45200, comments: 3200, shares: 12800 }, importance: 'high', tags: ['FSD', 'æ—¥æœ¬å¸‚å ´', 'è¦åˆ¶å¯¾å¿œ'] },
        { id: 3, title: 'Baidu Apolloã€æ·±ã‚»ãƒ³ã§1000å°è¦æ¨¡ã®ãƒ­ãƒœã‚¿ã‚¯ã‚·ãƒ¼é‹ç”¨ã‚’ç™ºè¡¨', summary: 'ä¸­å›½BaiduãŒæ·±ã‚»ãƒ³å¸‚ã¨ææºã—ã€ä¸–ç•Œæœ€å¤§è¦æ¨¡ã®ãƒ­ãƒœã‚¿ã‚¯ã‚·ãƒ¼ãƒ•ãƒªãƒ¼ãƒˆã‚’å±•é–‹ã€‚2025å¹´å†…ã«5éƒ½å¸‚ã¸ã®æ‹¡å¤§ã‚’è¨ˆç”»ã€‚', source: 'official', sourceDetail: 'Baiduå…¬å¼ç™ºè¡¨', company: 'baidu', url: '#', publishedAt: new Date(now - 8 * 60 * 60 * 1000).toISOString(), engagement: { likes: 1520, comments: 89, shares: 445 }, importance: 'high', tags: ['ä¸­å›½', 'ãƒ•ãƒªãƒ¼ãƒˆæ‹¡å¤§', 'æ·±ã‚»ãƒ³'] },
        { id: 4, title: 'r/SelfDrivingCars ã§è©±é¡Œ: Cruiseå¾©æ´»ã®å™‚ã€GMå†…éƒ¨ãƒªãƒ¼ã‚¯ã‹', summary: 'Redditã§GMé–¢ä¿‚è€…ã‚’åä¹—ã‚‹æŠ•ç¨¿ãŒè©±é¡Œã«ã€‚Cruiseã®ãƒ­ãƒœã‚¿ã‚¯ã‚·ãƒ¼äº‹æ¥­ãŒ2025å¹´å¾ŒåŠã«æ–°ä½“åˆ¶ã§å†é–‹ã™ã‚‹å¯èƒ½æ€§ã«ã¤ã„ã¦è­°è«–ãŒæ´»ç™ºåŒ–ã€‚', source: 'reddit', sourceDetail: 'r/SelfDrivingCars', company: 'cruise', url: '#', publishedAt: new Date(now - 12 * 60 * 60 * 1000).toISOString(), engagement: { likes: 2100, comments: 340, shares: 89 }, importance: 'medium', tags: ['Cruise', 'GM', 'å™‚', 'å¾©æ´»'] },
        { id: 5, title: 'Tier IVã€å›½å†…åˆã®å®Œå…¨ç„¡äººè‡ªå‹•é‹è»¢ãƒã‚¹ã®å…¬é“èµ°è¡Œè¨±å¯ã‚’å–å¾—', summary: 'Tier IVãŒé–‹ç™ºã™ã‚‹Autowareãƒ™ãƒ¼ã‚¹ã®è‡ªå‹•é‹è»¢ãƒã‚¹ãŒã€æ±äº¬éƒ½å†…ã®ç‰¹å®šã‚¨ãƒªã‚¢ã§å®Œå…¨ç„¡äººã§ã®å…¬é“èµ°è¡Œè¨±å¯ã‚’å›½åœŸäº¤é€šçœã‹ã‚‰å–å¾—ã€‚', source: 'news', sourceDetail: 'æ—¥çµŒæ–°è', company: 'tier4', url: '#', publishedAt: new Date(now - 3 * 60 * 60 * 1000).toISOString(), engagement: { likes: 890, comments: 67, shares: 234 }, importance: 'high', tags: ['æ—¥æœ¬', 'Autoware', 'ç„¡äººé‹è»¢', 'è¨±å¯'] },
        { id: 6, title: 'Pony.aiã€ãƒŠã‚¹ãƒ€ãƒƒã‚¯ä¸Šå ´ã«å‘ã‘SECç”³è«‹å®Œäº†', summary: 'ä¸­å›½ã®è‡ªå‹•é‹è»¢ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—Pony.aiãŒãƒŠã‚¹ãƒ€ãƒƒã‚¯ä¸Šå ´ã«å‘ã‘ãŸæ›¸é¡ã‚’SECã«æå‡ºã€‚è©•ä¾¡é¡ã¯85å„„ãƒ‰ãƒ«ã‚’æƒ³å®šã€‚', source: 'news', sourceDetail: 'Bloomberg', company: 'pony', url: '#', publishedAt: new Date(now - 6 * 60 * 60 * 1000).toISOString(), engagement: { likes: 1250, comments: 98, shares: 567 }, importance: 'medium', tags: ['IPO', 'ãƒŠã‚¹ãƒ€ãƒƒã‚¯', 'è³‡é‡‘èª¿é”'] },
        { id: 7, title: 'ã€è©±é¡Œã€‘Zooxã®æ–°å‹è»Šä¸¡ãƒ‡ã‚¶ã‚¤ãƒ³ãŒãƒªãƒ¼ã‚¯ã€å¾“æ¥ã®å€ã®ãƒãƒƒãƒ†ãƒªãƒ¼å®¹é‡ã‹', summary: 'Xã§æ‹¡æ•£ä¸­ã®ãƒªãƒ¼ã‚¯ç”»åƒã«ã‚ˆã‚‹ã¨ã€ZooxãŒé–‹ç™ºä¸­ã®æ¬¡ä¸–ä»£ãƒ­ãƒœã‚¿ã‚¯ã‚·ãƒ¼ã¯èˆªç¶šè·é›¢ãŒå¤§å¹…ã«ä¼¸ã³ã€é•·è·é›¢è¼¸é€ã«ã‚‚å¯¾å¿œå¯èƒ½ã«ã€‚', source: 'x', sourceDetail: '@AutonomousDrive', company: 'zoox', url: '#', publishedAt: new Date(now - 4 * 60 * 60 * 1000).toISOString(), engagement: { likes: 8900, comments: 450, shares: 2100 }, importance: 'medium', tags: ['ãƒªãƒ¼ã‚¯', 'æ–°å‹è»Šä¸¡', 'ãƒãƒƒãƒ†ãƒªãƒ¼'] },
        { id: 8, title: 'Hondaãƒ»Sonyã€AFEELAã®è‡ªå‹•é‹è»¢ãƒ¬ãƒ™ãƒ«3å¯¾å¿œã‚’2026å¹´ã«å‰å€’ã—', summary: 'ã‚½ãƒ‹ãƒ¼ãƒ»ãƒ›ãƒ³ãƒ€ãƒ¢ãƒ“ãƒªãƒ†ã‚£ãŒAFEELAã®è‡ªå‹•é‹è»¢æ©Ÿèƒ½ã‚’å¼·åŒ–ã€‚å½“åˆ2027å¹´äºˆå®šã ã£ãŸãƒ¬ãƒ™ãƒ«3å¯¾å¿œã‚’1å¹´å‰å€’ã—ã§å®Ÿè£…äºˆå®šã€‚', source: 'official', sourceDetail: 'Sony Honda Mobility', company: 'sony', url: '#', publishedAt: new Date(now - 10 * 60 * 60 * 1000).toISOString(), engagement: { likes: 3400, comments: 210, shares: 890 }, importance: 'high', tags: ['AFEELA', 'ãƒ¬ãƒ™ãƒ«3', 'å‰å€’ã—'] },
        { id: 9, title: 'WeRideã€UAEãƒ‰ãƒã‚¤ã§ã®è‡ªå‹•é‹è»¢ã‚¿ã‚¯ã‚·ãƒ¼é‹è¡Œè¨±å¯ã‚’å–å¾—', summary: 'ä¸­å›½WeRideãŒä¸­æ±é€²å‡ºã€‚ãƒ‰ãƒã‚¤ã§ã®å•†æ¥­é‹è¡Œè¨±å¯ã‚’å–å¾—ã—ã€2025å¹´Q2ã‹ã‚‰ã‚µãƒ¼ãƒ“ã‚¹é–‹å§‹äºˆå®šã€‚ä¸­æ±åˆã®ä¸­å›½è‡ªå‹•é‹è»¢ä¼æ¥­ã«ã€‚', source: 'news', sourceDetail: 'Reuters', company: 'weride', url: '#', publishedAt: new Date(now - 15 * 60 * 60 * 1000).toISOString(), engagement: { likes: 670, comments: 45, shares: 189 }, importance: 'medium', tags: ['ä¸­æ±', 'ãƒ‰ãƒã‚¤', 'æµ·å¤–å±•é–‹'] },
        { id: 10, title: 'Uberã€Waymoã¨ã®ææºã‚’ã‚¢ãƒˆãƒ©ãƒ³ã‚¿ã«ã‚‚æ‹¡å¤§ - ãƒ­ãƒœã‚¿ã‚¯ã‚·ãƒ¼äºˆç´„å¯èƒ½ã«', summary: 'Uberã‚¢ãƒ—ãƒªã‹ã‚‰Waymoã®ãƒ­ãƒœã‚¿ã‚¯ã‚·ãƒ¼ãŒäºˆç´„å¯èƒ½ãªã‚¨ãƒªã‚¢ãŒã‚¢ãƒˆãƒ©ãƒ³ã‚¿ã«ã‚‚æ‹¡å¤§ã€‚ä¸¡ç¤¾ã®ææºãŒç€å®Ÿã«é€²å±•ã€‚', source: 'news', sourceDetail: 'The Verge', company: 'uber', url: '#', publishedAt: new Date(now - 7 * 60 * 60 * 1000).toISOString(), engagement: { likes: 1890, comments: 123, shares: 456 }, importance: 'medium', tags: ['ææº', 'ã‚¢ãƒˆãƒ©ãƒ³ã‚¿', 'ã‚¢ãƒ—ãƒªé€£æº'] },
        { id: 11, title: 'æ—¥ç”£ã€ProPILOT 3.0ã§ãƒãƒ³ã‚ºã‚ªãƒ•èµ°è¡Œã‚¨ãƒªã‚¢ã‚’å…¨å›½é«˜é€Ÿé“è·¯ã«æ‹¡å¤§', summary: 'æ—¥ç”£ãŒæ¬¡ä¸–ä»£ãƒ—ãƒ­ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆã®è©³ç´°ã‚’ç™ºè¡¨ã€‚2025å¹´ç§‹ã‹ã‚‰ã®æ–°å‹è»Šã«æ­è¼‰ã—ã€æ—¥æœ¬å…¨å›½ã®é«˜é€Ÿé“è·¯ã§ãƒãƒ³ã‚ºã‚ªãƒ•èµ°è¡ŒãŒå¯èƒ½ã«ã€‚', source: 'official', sourceDetail: 'æ—¥ç”£è‡ªå‹•è»Š', company: 'nissan', url: '#', publishedAt: new Date(now - 9 * 60 * 60 * 1000).toISOString(), engagement: { likes: 2100, comments: 178, shares: 567 }, importance: 'high', tags: ['ProPILOT', 'ãƒãƒ³ã‚ºã‚ªãƒ•', 'æ—¥æœ¬'] },
        { id: 12, title: 'DiDiã€è‡ªå‹•é‹è»¢éƒ¨é–€ã‚’åˆ†ç¤¾åŒ– - ç‹¬ç«‹ã—ãŸIPOæ¤œè¨ã¸', summary: 'ä¸­å›½é…è»Šå¤§æ‰‹DiDiãŒè‡ªå‹•é‹è»¢éƒ¨é–€ã‚’åˆ†ç¤¾åŒ–ã™ã‚‹ã¨ç™ºè¡¨ã€‚ç‹¬ç«‹ã—ãŸå½¢ã§ã®IPOã‚’è¦–é‡ã«å…¥ã‚Œã€å¤–éƒ¨è³‡é‡‘èª¿é”ã‚’åŠ é€Ÿã€‚', source: 'news', sourceDetail: 'South China Morning Post', company: 'didi', url: '#', publishedAt: new Date(now - 20 * 60 * 60 * 1000).toISOString(), engagement: { likes: 890, comments: 67, shares: 234 }, importance: 'medium', tags: ['åˆ†ç¤¾åŒ–', 'IPO', 'çµ„ç¹”å†ç·¨'] },
        { id: 13, title: 'Auroraã€ãƒ†ã‚­ã‚µã‚¹å·ã§ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãƒ¬ã‚¹ãƒˆãƒ©ãƒƒã‚¯å•†ç”¨è¼¸é€ã‚’é–‹å§‹', summary: 'Aurora InnovationãŒãƒ†ã‚­ã‚µã‚¹å·ã®å…¬é“ã§ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ä¸åœ¨ã®è‡ªå‹•é‹è»¢ãƒˆãƒ©ãƒƒã‚¯ã«ã‚ˆã‚‹å•†ç”¨è²¨ç‰©è¼¸é€ã‚’é–‹å§‹ã€‚ç‰©æµæ¥­ç•Œã«é©å‘½ã‹ã€‚', source: 'news', sourceDetail: 'Forbes', company: 'aurora', url: '#', publishedAt: new Date(now - 11 * 60 * 60 * 1000).toISOString(), engagement: { likes: 3200, comments: 245, shares: 890 }, importance: 'high', tags: ['ãƒˆãƒ©ãƒƒã‚¯', 'ç‰©æµ', 'å•†ç”¨åŒ–'] },
        { id: 14, title: 'r/teslamotors: FSD v13ã®å®Ÿéš›ã®æŒ™å‹•ã‚’æ¤œè¨¼ - é©šç•°çš„ãªé€²åŒ–ã¨ã®å£°', summary: 'Redditãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒFSD v13ã®å®Ÿèµ°è¡Œå‹•ç”»ã‚’å¤šæ•°æŠ•ç¨¿ã€‚è¤‡é›‘ãªäº¤å·®ç‚¹ã‚„å¤œé–“èµ°è¡Œã§ã®æ€§èƒ½å‘ä¸Šã«é©šãã®å£°ãŒç›¸æ¬¡ãã€‚', source: 'reddit', sourceDetail: 'r/teslamotors', company: 'tesla', url: '#', publishedAt: new Date(now - 14 * 60 * 60 * 1000).toISOString(), engagement: { likes: 5600, comments: 890, shares: 340 }, importance: 'medium', tags: ['FSD', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¬ãƒ“ãƒ¥ãƒ¼', 'å‹•ç”»'] },
        { id: 15, title: 'Toyotaã€Woven Cityã§ã®è‡ªå‹•é‹è»¢å®Ÿè¨¼å®Ÿé¨“ã®ä¸­é–“å ±å‘Šã‚’å…¬é–‹', summary: 'ãƒˆãƒ¨ã‚¿ãŒé™å²¡çœŒã®Woven Cityã§è¡Œã£ã¦ã„ã‚‹è‡ªå‹•é‹è»¢å®Ÿè¨¼å®Ÿé¨“ã®é€²æ—ã‚’ç™ºè¡¨ã€‚ç”Ÿæ´»ç©ºé–“ã«ãŠã‘ã‚‹è‡ªå‹•é‹è»¢ã®æ–°ãŸãªçŸ¥è¦‹ã‚’å…±æœ‰ã€‚', source: 'official', sourceDetail: 'Toyota', company: 'toyota', url: '#', publishedAt: new Date(now - 18 * 60 * 60 * 1000).toISOString(), engagement: { likes: 1560, comments: 89, shares: 345 }, importance: 'medium', tags: ['Woven City', 'å®Ÿè¨¼å®Ÿé¨“', 'ç ”ç©¶'] },
        { id: 16, title: 'ã€é€Ÿå ±ã€‘Lucidã€è‡ªå‹•é‹è»¢æŠ€è¡“ã§Mobileyeã¨ã®ç‹¬å å¥‘ç´„ã‚’ç· çµ', summary: 'Lucid MotorsãŒIntelå‚˜ä¸‹ã®Mobileyeã¨è‡ªå‹•é‹è»¢æŠ€è¡“ã§ç‹¬å ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—å¥‘ç´„ã€‚æ¬¡ä¸–ä»£Lucid Airã«æœ€æ–°ADASã‚’æ­è¼‰äºˆå®šã€‚', source: 'news', sourceDetail: 'Electrek', company: 'lucid', url: '#', publishedAt: new Date(now - 1 * 60 * 60 * 1000).toISOString(), engagement: { likes: 4500, comments: 320, shares: 1200 }, importance: 'high', tags: ['ææº', 'Mobileye', 'ADAS'] }
      ];
    }

    // ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•° =====
    function calculatePriorityScore(news) {
      const now = new Date();
      const publishedAt = new Date(news.publishedAt);
      const hoursAgo = (now - publishedAt) / (1000 * 60 * 60);
      const timeScore = Math.max(0, 100 - hoursAgo * 4);
      const totalEngagement = news.engagement.likes + news.engagement.comments * 3 + news.engagement.shares * 2;
      const engagementScore = Math.min(100, Math.log10(totalEngagement + 1) * 25);
      const source = SOURCES.find(s => s.id === news.source);
      const sourceScore = (source ? source.weight : 1.0) * 30;
      const importanceBonus = news.importance === 'high' ? 20 : news.importance === 'medium' ? 10 : 0;
      return Math.round(timeScore * 0.3 + engagementScore * 0.35 + sourceScore * 0.2 + importanceBonus * 0.15);
    }

    function getTimeAgo(dateString) {
      const now = new Date();
      const date = new Date(dateString);
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / (1000 * 60));
      const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
      if (diffMins < 60) return diffMins + 'åˆ†å‰';
      if (diffHours < 24) return diffHours + 'æ™‚é–“å‰';
      return diffDays + 'æ—¥å‰';
    }

    function getPriorityColor(score) {
      if (score >= 70) return '#22c55e';
      if (score >= 50) return '#eab308';
      if (score >= 30) return '#f97316';
      return '#94a3b8';
    }

    function getCompany(id) { return COMPANIES.find(c => c.id === id); }
    function getSource(id) { return SOURCES.find(s => s.id === id); }

    // ===== çŠ¶æ…‹ç®¡ç† =====
    let newsData = [];
    let selectedCountry = 'all';
    let selectedSources = [];
    let selectedCompanies = [];
    let searchQuery = '';
    let sortBy = 'priority';

    // ===== UIæ›´æ–°é–¢æ•° =====
    function toggleFilters() {
      const panel = document.getElementById('filterPanel');
      const btn = document.getElementById('filterToggle');
      panel.classList.toggle('show');
      btn.classList.toggle('active');
    }

    function renderTopNews(news) {
      const container = document.getElementById('topNews');
      const top3 = news.slice(0, 3);
      container.innerHTML = top3.map((item, index) => {
        const company = getCompany(item.company);
        const source = getSource(item.source);
        const score = item.priorityScore;
        return `
          <div class="top-news-card">
            <div class="rank-badge rank-${index + 1}">${index + 1}</div>
            <div class="tags">
              <span class="tag" style="background: ${company.color}">${company.name}</span>
              <span class="tag tag-source">${source.icon} ${source.name}</span>
            </div>
            <h3 class="card-title">${item.title}</h3>
            <p class="card-summary">${item.summary.slice(0, 100)}...</p>
            <div class="card-footer">
              <span class="score-badge" style="background: ${getPriorityColor(score)}">â­ ã‚¹ã‚³ã‚¢: ${score}</span>
              <span class="time-ago">${getTimeAgo(item.publishedAt)}</span>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderNewsList(news) {
      const container = document.getElementById('newsList');
      document.getElementById('newsCount').textContent = `(${news.length}ä»¶)`;

      container.innerHTML = news.map(item => {
        const company = getCompany(item.company);
        const source = getSource(item.source);
        const score = item.priorityScore;
        const color = getPriorityColor(score);

        let importanceBadge = '';
        if (item.importance === 'high') {
          importanceBadge = '<span class="meta-tag importance-badge" style="background: #fee2e2; color: #dc2626;">é‡è¦</span>';
        } else if (item.importance === 'medium') {
          importanceBadge = '<span class="meta-tag importance-badge" style="background: #fef3c7; color: #d97706;">æ³¨ç›®</span>';
        }

        return `
          <article class="news-item">
            <div class="priority-bar" style="background: ${color}"></div>
            <div class="news-content">
              <div class="news-meta">
                <span class="meta-tag" style="background: ${company.color}; font-weight: 600;">${company.name}</span>
                <span class="meta-tag" style="background: rgba(148, 163, 184, 0.15);">${source.icon} ${source.name} Â· ${item.sourceDetail}</span>
                ${importanceBadge}
                <span class="time-ago" style="margin-left: auto;">${getTimeAgo(item.publishedAt)}</span>
              </div>
              <h3 class="news-title">${item.title}</h3>
              <p class="news-summary">${item.summary}</p>
              <div class="hash-tags">
                ${item.tags.map(tag => `<span class="hash-tag">#${tag}</span>`).join('')}
              </div>
              <div class="news-footer">
                <div class="engagement">
                  <span>â¤ï¸ ${item.engagement.likes.toLocaleString()}</span>
                  <span>ğŸ’¬ ${item.engagement.comments.toLocaleString()}</span>
                  <span>ğŸ”„ ${item.engagement.shares.toLocaleString()}</span>
                </div>
                <div class="news-actions">
                  <span class="priority-badge" style="background: ${color}22; border: 1px solid ${color}; color: ${color};">å„ªå…ˆåº¦: ${score}</span>
                  <a href="${item.url}" class="btn-read">è¨˜äº‹ã‚’èª­ã‚€ â†’</a>
                </div>
              </div>
            </div>
          </article>
        `;
      }).join('');
    }

    function renderFilters() {
      // Country filters
      document.getElementById('countryFilters').innerHTML = COUNTRIES.map(c =>
        `<button class="filter-btn ${selectedCountry === c.id ? 'active' : ''}" onclick="setCountry('${c.id}')">${c.flag} ${c.name}</button>`
      ).join('');

      // Source filters
      document.getElementById('sourceFilters').innerHTML = SOURCES.map(s =>
        `<button class="filter-btn ${selectedSources.includes(s.id) ? 'active' : ''}" onclick="toggleSource('${s.id}')">${s.icon} ${s.name}</button>`
      ).join('');

      // Company filters
      document.getElementById('companyFilters').innerHTML = COMPANIES.map(c => {
        const isActive = selectedCompanies.includes(c.id);
        return `<button class="company-btn" style="border-color: ${isActive ? c.color : 'transparent'}; background: ${isActive ? c.color + '33' : 'rgba(15, 23, 42, 0.8)'};" onclick="toggleCompany('${c.id}')">${c.name}</button>`;
      }).join('');
    }

    function filterAndSort() {
      let result = newsData.map(n => ({ ...n, priorityScore: calculatePriorityScore(n) }));

      // Apply filters
      if (selectedSources.length > 0) {
        result = result.filter(n => selectedSources.includes(n.source));
      }
      if (selectedCompanies.length > 0) {
        result = result.filter(n => selectedCompanies.includes(n.company));
      }
      if (selectedCountry !== 'all') {
        const countryCompanies = COMPANIES.filter(c => c.country === selectedCountry).map(c => c.id);
        result = result.filter(n => countryCompanies.includes(n.company));
      }
      if (searchQuery) {
        const q = searchQuery.toLowerCase();
        result = result.filter(n =>
          n.title.toLowerCase().includes(q) ||
          n.summary.toLowerCase().includes(q) ||
          n.tags.some(t => t.toLowerCase().includes(q))
        );
      }

      // Sort
      if (sortBy === 'priority') {
        result.sort((a, b) => b.priorityScore - a.priorityScore);
      } else if (sortBy === 'time') {
        result.sort((a, b) => new Date(b.publishedAt) - new Date(a.publishedAt));
      } else if (sortBy === 'engagement') {
        result.sort((a, b) => (b.engagement.likes + b.engagement.shares) - (a.engagement.likes + a.engagement.shares));
      }

      return result;
    }

    function updateUI() {
      const filtered = filterAndSort();
      renderTopNews(filtered);
      renderNewsList(filtered);
      renderFilters();
    }

    // ===== ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ© =====
    function setCountry(id) {
      selectedCountry = id;
      updateUI();
    }

    function toggleSource(id) {
      if (selectedSources.includes(id)) {
        selectedSources = selectedSources.filter(s => s !== id);
      } else {
        selectedSources.push(id);
      }
      updateUI();
    }

    function toggleCompany(id) {
      if (selectedCompanies.includes(id)) {
        selectedCompanies = selectedCompanies.filter(c => c !== id);
      } else {
        selectedCompanies.push(id);
      }
      updateUI();
    }

    // ===== JSONãƒ‡ãƒ¼ã‚¿å–å¾— =====
    async function fetchNewsData() {
      try {
        const response = await fetch('./news-data.json');
        if (!response.ok) throw new Error('JSON not found');
        const data = await response.json();

        // æœ€çµ‚æ›´æ–°æ—¥æ™‚ã‚’è¡¨ç¤º
        if (data.lastUpdated) {
          const date = new Date(data.lastUpdated);
          document.getElementById('lastUpdated').textContent = 'æœ€çµ‚æ›´æ–°: ' + date.toLocaleString('ja-JP', {
            year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit'
          });
        }

        console.log('âœ… news-data.json ã‹ã‚‰ ' + data.news.length + ' ä»¶ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
        return data.news;
      } catch (error) {
        console.log('âš ï¸ news-data.json ãŒè¦‹ã¤ã‹ã‚‰ãªã„ãŸã‚ã€ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¾ã™');
        document.getElementById('lastUpdated').textContent = 'æœ€çµ‚æ›´æ–°: ' + new Date().toLocaleString('ja-JP', {
          year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit'
        }) + ' (ãƒ‡ãƒ¢)';
        return generateMockNews();
      }
    }

    // ===== åˆæœŸåŒ– =====
    document.addEventListener('DOMContentLoaded', async function() {
      // Load data (JSONã¾ãŸã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯)
      newsData = await fetchNewsData();

      // Setup event listeners
      document.getElementById('searchInput').addEventListener('input', function(e) {
        searchQuery = e.target.value;
        updateUI();
      });

      document.getElementById('sortSelect').addEventListener('change', function(e) {
        sortBy = e.target.value;
        updateUI();
      });

      // Initial render
      updateUI();
    });
  </script>
</body>
</html>
